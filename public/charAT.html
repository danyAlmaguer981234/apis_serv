<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.js"></script>
    <script src="https://momentjs.com/downloads/moment.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.4.0/js/dataTables.select.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" />
    <link href="https://cdn.datatables.net/select/1.4.0/css/select.dataTables.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <title>Document</title>
</head>

<body>

    <div class="container">

        <form class="row g-3">
            <div class="col-6">
                <label for="inputAddress" class="form-label">MAQUINA</label>

            </div>
            <div class="col-7">
                <select id="maq" class="form-select" aria-label="Default select example">
                    <option selected>Seleccione la Maquina</option>
                    <option value="MTU1">MTU1</option>
                    <option value="MTU2">MTU2</option>

                </select>
            </div>




        </form>
        <center>
            <div id="loading" class="container">
                <img src="mario.gif" />
                <p>Obteniendo datos...</p>
            </div>
        </center>
        <div>
            <canvas id="myChart"></canvas>
        </div>
    </div>

</body>

</html>
<script type="text/javascript">
    $(document).ajaxStart(function () {
        $('#loading').show();
        $('#myChart').hide();
    }).ajaxStop(function () {
        $('#loading').hide();
        $('#myChart').show();

    });

    $(document).ready(function () {
        $('#loading').hide();
        var myChart;

        $('#maq').on('change', function () {
            $.ajax({
                type: "GET",
                url: "http://10.11.1.240:8000/api/chart",
                async: true,
                dataType: "json",
                data: {
                    'maquina': $("#maq option:selected").text(),

                },//c
                success: function (response) {
                    console.log(response);
                },
            }).done(
                function (dataT, textStatus, jqXHR) {

                    var nombre = [];
                    var stock = [];
                    var ordenada = [];

                    for (var i in dataT) {
                        nombre.push(dataT[i].fe_transaccion);
                        stock.push(dataT[i].total_cn_conv);
                        ordenada.push(dataT[i].cn_ordenada);
                    }



                    const datosP = {
                        label: "Toneladas producidas",
                        data: stock, // La data es un arreglo que debe tener la misma cantidad de valores que la cantidad de etiquetas
                        backgroundColor: 'rgba(54, 162, 235, 0.2)', // Color de fondo
                        borderColor: 'rgba(54, 162, 235, 1)', // Color del borde
                        borderWidth: 5,// Ancho del borde
                    };
                    const datosO = {
                        label: "Toneladas Ordenadas",
                        data: ordenada, // La data es un arreglo que debe tener la misma cantidad de valores que la cantidad de etiquetas
                        backgroundColor: 'rgba(255, 159, 64, 0.2)',// Color de fondo
                        borderColor: 'rgba(255, 159, 64, 1)',// Color del borde
                        borderWidth: 4,// Ancho del borde
                    };


                    const config = {
                        type: 'line',
                        data: {
                            labels: nombre,
                            datasets: [
                            datosP,
                            datosO,
                                // Aquí más datos...
                            ]
                        },
                        options: {}
                    };

                    if (myChart) {
                        myChart.destroy();
                    }
                    myChart = new Chart(
                        document.getElementById('myChart'),
                        config
                    );


                }).fail(function (data) {
                    alert("Algo salió mal" + data.error);
                    var errors = data.responseJSON;

                });

        });

    });

</script>
<script>

</script>